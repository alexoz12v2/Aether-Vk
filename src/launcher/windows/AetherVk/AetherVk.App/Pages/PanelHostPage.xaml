<Page
    x:Class="AetherVk.Pages.PanelHostPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:AetherVk.Pages"
    xmlns:vm="using:AetherVk.Core.ViewModels"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="using:CommunityToolkit.WinUI"
    xmlns:media="using:CommunityToolkit.WinUI.Media"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    mc:Ignorable="d">
    <Page.MinWidth>256</Page.MinWidth>
    <Page.Resources>
        <vm:PanelHostPageViewModel x:Key="ViewModel" />
        
        <Storyboard x:Key="ChevronRotateUp">
            <DoubleAnimation Storyboard.TargetName="ChevronRotate"
                             Storyboard.TargetProperty="Angle"
                             To="180"
                             Duration="0:0:0.15"
                             EnableDependentAnimation="True">
                <DoubleAnimation.EasingFunction>
                    <QuadraticEase EasingMode="EaseInOut" />
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>
        <Storyboard x:Key="ChevronRotateDown">
            <DoubleAnimation Storyboard.TargetName="ChevronRotate"
                             Storyboard.TargetProperty="Angle"
                             To="0"
                             Duration="0:0:0.15"
                             EnableDependentAnimation="True">
                <DoubleAnimation.EasingFunction>
                    <QuadraticEase EasingMode="EaseInOut" />
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>

        <SolidColorBrush x:Key="TabColor" Color="#770E0E0E"/>
    </Page.Resources>

    <Border Margin="{StaticResource SpacingControl}" CornerRadius="12" Background="Transparent">
        <media:UIElementExtensions.VisualFactory>
            <media:PipelineVisualFactory Source="{media:BackdropSource}">
                <media:BlurEffect Amount="15" />
            </media:PipelineVisualFactory>
        </media:UIElementExtensions.VisualFactory>

        <Grid RowDefinitions="32,*" Background="Transparent" RowSpacing="0">
            <!-- Local Control Resources -->
            <Grid.Resources>
                <Style x:Key="BaseButtonStyle" TargetType="Button" BasedOn="{StaticResource DefaultButtonStyle}">
                    <Setter Property="MaxWidth" Value="24"/>
                    <Setter Property="VerticalAlignment" Value="Center" />
                </Style>
                <Style TargetType="Button" BasedOn="{StaticResource BaseButtonStyle}"/>
                <Style x:Key="MainButtonStyle" TargetType="Button" BasedOn="{StaticResource BaseButtonStyle}">
                    <Setter Property="MaxWidth" Value="48"/>
                    <Setter Property="BorderThickness" Value="0" />
                </Style>
            </Grid.Resources>

            <!-- Local Responsive States -->
            <VisualStateManager.VisualStateGroups>
                <VisualStateGroup x:Name="ResponsiveStates">
                    <!-- Wide Layout-->
                    <VisualState x:Name="WideState">
                        <VisualState.StateTriggers>
                            <AdaptiveTrigger MinWindowWidth="{StaticResource PageBreakpoint620}" />
                        </VisualState.StateTriggers>
                        <VisualState.Setters>
                            <!-- HeaderBorder: Header Margin -->
                            <Setter Target="HeaderBorder.Margin" Value="24,0,0,0" />
                            <!-- HeaderBorder: Corner Radius TODO: Left/Right DependencyProperty -->
                            <Setter Target="HeaderBorder.CornerRadius" Value="12,12,0,0" />
                            <!-- HeaderIcon: Icon Scale -->
                            <Setter Target="HeaderIcon.FontSize" Value="20" />
                        </VisualState.Setters>
                    </VisualState>
                    <!-- Narrow Layout -->
                    <VisualState x:Name="NarrowState">
                        <VisualState.StateTriggers>
                            <AdaptiveTrigger MinWindowWidth="0" />
                        </VisualState.StateTriggers>
                        <VisualState.Setters>
                            <!-- HeaderBorder: Remove Header Margin -->
                            <Setter Target="HeaderBorder.Margin" Value="0" />
                            <!-- HeaderBorder: only left corner radius. TODO: Left/Right DependencyProperty -->
                            <Setter Target="HeaderBorder.CornerRadius" Value="12,0,0,0" />
                            <!-- HeaderIcon: Smaller Icon Scale -->
                            <Setter Target="HeaderIcon.FontSize" Value="14" />
                        </VisualState.Setters>
                    </VisualState>
                </VisualStateGroup>
            </VisualStateManager.VisualStateGroups>

            <!-- {StaticResource AcrylicBrushBlurred} -->
            <!-- Header "Folder Tab" -->
            <Border x:Name="HeaderBorder"
                    Grid.Row="0" 
                    Margin="24,0,0,0"
                    CornerRadius="12,12,0,0"
                    Width="192"
                    Background="{StaticResource TabColor}" 
                    Padding="{StaticResource ButtonPadding}"
                    HorizontalAlignment="Left"
                    VerticalAlignment="Stretch">
                <Button Style="{StaticResource MainButtonStyle}" 
                        HorizontalContentAlignment="Center"
                        Background="Transparent">
                    <Button.Content>
                        <Canvas Width="24" Height="24" Scale="0.7,0.7,0.7">
                            <!-- https://learn.microsoft.com/en-us/windows/apps/develop/ui/controls/shapes#path -->
                            <Path Stroke="White"
                                  StrokeThickness="2"
                                  StrokeEndLineCap="Round"
                                  StrokeStartLineCap="Round"
                                  Data="M 0 0 L 12 12 L 24 0">
                                <Path.RenderTransform>
                                    <RotateTransform x:Name="ChevronRotate" CenterX="12" CenterY="6" />
                                </Path.RenderTransform>
                            </Path>
                        </Canvas>
                    </Button.Content>
                    <!-- When Chevron Opened, show flyout with all buttons -->
                    <Button.Flyout>
                        <Flyout x:Name="HeaderFlyout" Opened="HeaderFlyout_Opened" Closed="HeaderFlyout_Closed" >
                            <controls:UniformGrid>
                                <AppBarButton Icon="{ui:FontIcon FontSize={StaticResource CaptionTextBlockFontSize}, Glyph={StaticResource GlyphHome}}" Label="Splash Screen"/>
                            </controls:UniformGrid>
                        </Flyout>
                    </Button.Flyout>
                </Button>
            </Border>
            <Border 
                x:Name="OuterBorder"
                CornerRadius="12"  
                Grid.Row="1"
                PointerMoved="OuterBorder_PointerMoved"
                PointerExited="OuterBorder_PointerExited"
                BorderThickness="{StaticResource PaddingItem}"
                BorderBrush="{StaticResource TabColor}"
                Background="{StaticResource TabColor}">
                <Rectangle Fill="Aqua" />
            </Border>
        </Grid>
    </Border>
</Page>
